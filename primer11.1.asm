	ORG	32768
	CALL	SETUP
CITAJ:
	HALT
	LD	BC,$FBFE
	IN	A,(C)
	BIT	0,A
	RET	Z
	BIT	1,A
	CALL	Z,MOVE_UP
	LD	BC,$FDFE
	IN	A,(C)
	BIT	0,A
	CALL	Z,MOVE_LEFT
	BIT	1,A
	CALL	Z,MOVE_DOWN
	BIT	2,A
	CALL	Z,MOVE_RIGHT
	JP	CITAJ
SETUP:
	LD	HL,22528
	LD	A,%00101000
	LD	C,3
NEXT_BLOCK:
	LD	B,0
LOOP:
	LD	(HL),A
	INC	HL
	DEC	B
	JP	NZ,LOOP
	DEC	C
	JP	NZ,NEXT_BLOCK

	LD	HL,22895
	LD	BC,$FDFE
	LD	(HL),%00010000

	RET
MOVE_LEFT:
	PUSH	AF
	LD	A,L
	AND	%00011111
	JP	Z,ML_SKIP
	LD	(HL),%00101000
	DEC	HL
	LD	(HL),%00010000
ML_SKIP:
	POP	AF
	RET
MOVE_RIGHT:
	PUSH	AF
	LD	A,L
	AND	%00011111
	CP	%00011111
	JP	Z,MR_SKIP
	LD	(HL),%00101000
	INC	HL
	LD	(HL),%00010000
MR_SKIP:
	POP	AF
	RET
MOVE_UP:
	PUSH	AF
	LD	A,H
	AND	%00000011
	LD	B,A
	LD	A,L
	AND	%11100000
	OR	B
	JP	Z,MU_SKIP
	LD	DE,-32
	LD	(HL),%00101000
	ADD	HL,DE
	LD	(HL),%00010000
MU_SKIP:
	POP	AF
	RET
MOVE_DOWN:
	PUSH	AF
	LD	A,H
	AND	%00000011
	LD	B,A
	LD	A,L
	AND	%11100000
	OR	B
	CP	%11100010
	JP	Z,MD_SKIP
	LD	DE,32
	LD	(HL),%00101000
	ADD	HL,DE
	LD	(HL),%00010000
MD_SKIP:
	POP	AF
	RET
